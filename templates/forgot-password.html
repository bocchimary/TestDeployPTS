<!DOCTYPE html>
{% load static %}
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Forgot Password - PTS College and Advanced Studies</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="{% static 'css/login.style.css' %}" />

    <style>
      main {
      background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('{% static 'images/ptsbg.png' %}');
       background-size: cover;
       background-position: center center;
       background-repeat: no-repeat;
       background-attachment: fixed;
       width: 100%;
       height: 100%;
      }
      .forgot-password-container {
        background: rgba(248, 248, 255, 1);
        border-radius: 15px;
        padding: 40px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        max-width: 500px;
        margin: auto;
      }
      
      .forgot-title {
        color: #2E5978;
        font-weight: 600;
        margin-bottom: 20px;
      }
      
      .back-to-login {
        color: #2E5978;
        text-decoration: none;
        font-size: 14px;
      }
      
      .back-to-login:hover {
        color: #1a3a4f;
        text-decoration: underline;
      }
      
      .submit-btn {
        background-color: #2E5978;
        border: none;
        border-radius: 25px;
        padding: 12px 30px;
        font-weight: 500;
      }
      
      .submit-btn:hover {
        background-color: #1a3a4f;
      }
    </style>
  </head>

  <body>
   <!-- Main Section -->
<main class="container-fluid min-vh-100 d-flex justify-content-center align-items-center">

<!-- Forgot Password Card -->
<div class="forgot-password-container">
<!-- Back to Login Link -->
<div class="text-start mb-3">
<a href="{% url 'login' %}" class="back-to-login">
  <i class="bi bi-arrow-left me-2"></i>Back to Login
</a>
</div>

<h2 class="text-center forgot-title">üîê Forgot Password</h2>
<p class="text-center text-muted mb-4">
Enter your email address and we'll send you instructions to reset your password.
</p>

<!-- Messages -->
{% if messages %}
{% for message in messages %}
  <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
    {{ message }}
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>
{% endfor %}
{% endif %}

<!-- Forgot Password Form -->
<form method="POST" action="{% url 'forgot_password_submit' %}" id="forgotPasswordForm">
{% csrf_token %}

<div class="form-group mb-4">
  <label for="email" class="form-label">Email Address</label>
  <input
    type="email"
    name="email"
    id="email"
    class="form-control"
    required
    placeholder="Enter your email address"
    aria-label="Email address"
    autocomplete="email"
  />
  <div id="email-feedback" class="invalid-feedback"></div>
</div>

<div class="d-flex justify-content-center mb-4">
  <button type="submit" class="btn submit-btn w-100 text-white" id="submitBtn">
    üìß Send Reset Instructions
  </button>
</div>

<!-- Success Message -->
<div id="success-message" class="alert alert-success d-none" role="alert">
  <i class="bi bi-check-circle-fill me-2"></i>
  <strong>Email sent!</strong> 
  <p class="mb-2 mt-2">
    If an account with that email exists, password reset instructions have been sent. Please check your inbox.
  </p>
  <div class="d-flex justify-content-between align-items-center mt-3">
    <small class="text-success">
      <i class="bi bi-info-circle me-1"></i>
      Check your spam folder if you don't see the email
    </small>
    <a href="{% url 'login' %}" class="btn btn-sm btn-outline-success">
      <i class="bi bi-box-arrow-in-right me-1"></i>Go to Login
    </a>
  </div>
</div>

<!-- Error Message -->
<div id="error-message" class="alert alert-danger d-none" role="alert">
  <i class="bi bi-exclamation-triangle-fill me-2"></i>
  <span id="error-text">An error occurred. Please try again.</span>
</div>

<div class="text-center">
  <hr class="border border-dark border-1 opacity-25 my-3" />
  <p class="text-muted mb-0">
    Remember your password? 
    <a href="{% url 'login' %}" class="back-to-login">Sign in here</a>
  </p>
</div>
</form>
</div>
</main>


    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Auto-focus on email input
      document.getElementById('email').focus();
      
      // Handle form submission with AJAX
      document.getElementById('forgotPasswordForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const form = this;
        const email = document.getElementById('email').value.trim();
        const submitBtn = document.getElementById('submitBtn');
        const successMessage = document.getElementById('success-message');
        const errorMessage = document.getElementById('error-message');
        const emailInput = document.getElementById('email');
        const emailFeedback = document.getElementById('email-feedback');
        
        // Clear previous messages and validation
        successMessage.classList.add('d-none');
        errorMessage.classList.add('d-none');
        emailInput.classList.remove('is-invalid');
        emailFeedback.textContent = '';
        
        // Validate email
        if (!email) {
          emailInput.classList.add('is-invalid');
          emailFeedback.textContent = 'Please enter your email address.';
          emailFeedback.style.display = 'block';
          return;
        }
        
        if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
          emailInput.classList.add('is-invalid');
          emailFeedback.textContent = 'Please enter a valid email address.';
          emailFeedback.style.display = 'block';
          return;
        }
        
        // Show loading state
        const originalButtonText = submitBtn.innerHTML;
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Sending...';
        
        // Prepare form data
        const formData = new FormData(form);
        
        // Get CSRF token
        const csrfToken = form.querySelector('[name=csrfmiddlewaretoken]').value;
        
        // Submit form via AJAX
        fetch(form.action, {
          method: 'POST',
          body: formData,
          headers: {
            'X-CSRFToken': csrfToken,
            'X-Requested-With': 'XMLHttpRequest'
          }
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            // Show success message
            document.getElementById('success-text').textContent = data.message;
            successMessage.classList.remove('d-none');
            emailInput.value = ''; // Clear the form
            
            // Scroll to success message
            successMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
          } else {
            // Show error message
            document.getElementById('error-text').textContent = data.message || 'An error occurred. Please try again.';
            errorMessage.classList.remove('d-none');
            
            // Scroll to error message
            errorMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
          }
        })
        .catch(error => {
          console.error('Error:', error);
          document.getElementById('error-text').textContent = 'Network error occurred. Please try again.';
          errorMessage.classList.remove('d-none');
          
          // Scroll to error message
          errorMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
        })
        .finally(() => {
          // Restore button state
          submitBtn.disabled = false;
          submitBtn.innerHTML = originalButtonText;
        });
      });
    </script>
  </body>
</html>