{% extends 'main-registrar.html' %}
{% load static %}

{% block title %}Registrar Dashboard{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/RDASHBOARD.css' %}">
{% endblock %}

{% block main_content %}

  <div class="registrar_dashboard_main-content" id="registrar_dashboard_main_content">
    <div class="text-end text-muted mb-2 small">
      <strong>Date:</strong> <span id="registrar_dashboard_dateToday"></span>
    </div>
    <h1 class="fw-bold" id="registrar_dashboard_title">Dashboard</h1>
    <p id="registrar_dashboard_welcome">Welcome, <strong>{{ user.full_name }}</strong>!</p>
    <form id="registrar_dashboard_form">
      <div class="container-fluid mt-4" id="registrar_dashboard_container">
        <div class="row" id="registrar_dashboard_row">
          <!-- Main Content -->
          <main class="col-lg-12" id="registrar_dashboard_main_column">
            <!-- Summary Boxes -->
            <div class="row g-1 mb-3" id="registrar_dashboard_summary_boxes">
              <div class="col-md-2 col-sm-4" id="registrar_dashboard_clearance_request_card">
                <div class="card summary-card border-start border-success border-3">
                  <small class="text-uppercase text-muted fw-semibold">Clearance Requests</small>
                  <h5 class="fw-bold mb-0">{{ total_clearance_requests }}</h5>
                  <small class="text-muted">{{ pending_clearance_requests }} pending</small>
                </div>
              </div>
              <div class="col-md-2 col-sm-4" id="registrar_dashboard_enrollment_request_card">
                <div class="card summary-card border-start border-primary border-3">
                  <small class="text-uppercase text-muted fw-semibold">Enrollment Requests</small>
                  <h5 class="fw-bold mb-0">{{ total_enrollment_requests }}</h5>
                  <small class="text-muted">{{ pending_enrollment_requests }} pending</small>
                </div>
              </div>
              <div class="col-md-2 col-sm-4" id="registrar_dashboard_graduation_request_card">
                <div class="card summary-card border-start border-success border-3">
                  <small class="text-uppercase text-muted fw-semibold">Graduation Requests</small>
                  <h5 class="fw-bold mb-0">{{ total_graduation_requests }}</h5>
                  <small class="text-muted">{{ pending_graduation_requests }} pending</small>
                </div>
              </div>
              <div class="col-md-2 col-sm-4" id="registrar_dashboard_pending_signatures_card">
                <div class="card summary-card border-start border-warning border-3">
                  <small class="text-uppercase text-muted fw-semibold">Pending Signatures</small>
                  <h5 class="fw-bold mb-0">{{ pending_signatures_count }}</h5>
                  <small class="text-muted">{{ new_signatures_today }} since yesterday</small>
                </div>
              </div>
              <div class="col-md-2 col-sm-4" id="registrar_dashboard_disapproved_forms_card">
                <div class="card summary-card border-start border-danger border-3">
                  <small class="text-uppercase text-muted fw-semibold">Disapproved Forms</small>
                  <h5 class="fw-bold mb-0">{{ disapproved_forms_count }}</h5>
                  <small class="text-muted">{{ recently_disapproved }} recently</small>
                </div>
              </div>
              <div class="col-md-2 col-sm-4" id="registrar_dashboard_document_requests_card">
                <div class="card summary-card border-start border-danger border-3">
                  <small class="text-uppercase text-muted fw-semibold">Document Requests</small>
                  <h5 class="fw-bold mb-0">{{ total_document_requests }}</h5>
                  <small class="text-muted">{{ pending_document_requests }} pending</small>
                </div>
              </div>

            </div>

            <!-- Charts -->
            <div class="row g-2 mt-3" id="registrar_dashboard_charts_row">
              <div class="col-md-3" id="registrar_dashboard_chart_accomplishment_card">
                <div class="card p-3 dashboard-box">
                  <h6 class="fw-semibold mb-2">Total Accomplishment</h6>
                  <div id="registrar_dashboard_totalAccomplishmentChart" style="flex-grow: 1;"></div>
                </div>
              </div>
              <div class="col-md-3" id="registrar_dashboard_chart_visitors_card">
                <div class="card p-3 dashboard-box">
                  <h6 class="fw-semibold mb-2">Visitors</h6>
                  <div id="registrar_dashboard_visitorsChart" style="flex-grow: 1;"></div>
                </div>
              </div>
              <div class="col-md-3" id="registrar_dashboard_chart_documents_card">
                <div class="card p-3 dashboard-box">
                  <h6 class="fw-semibold mb-2">Documents Released</h6>
                  <div id="registrar_dashboard_documentsReleasedChart" style="flex-grow: 1;"></div>
                </div>
              </div>
              <!-- Sidebar -->
          <aside class="col-md-3" id="registrar_dashboard_sidebar_calendar_column">
            <div class="card p-3 calendar-container mb-3" id="registrar_dashboard_calendar_card">
              <h6 class="fw-semibold mb-3">Calendar</h6>
              <iframe
                id="registrar_dashboard_calendar_iframe"
                src="https://calendar.google.com/calendar/embed?src=en.philippines%23holiday%40group.v.calendar.google.com&ctz=Asia%2FManila"
                frameborder="0"
                scrolling="yes"
                style="width: 100%; height: 280px; border: none; border-radius: 5px;"
              ></iframe>
              
              <div class="mt-3" id="registrar_dashboard_upcoming_events">
                <h6 class="fw-bold mb-2">
                  <i class="bi bi-calendar-event"></i> Upcoming Events
                  <small class="text-muted ms-2">(Click + to add to Google Calendar)</small>
                </h6>
                <div class="registrar_dashboard_scrollable_events">
                  {% for event in upcoming_events %}
                  <div class="event-item event-{{ event.color }}">
                    <div class="d-flex justify-content-between align-items-start">
                      <div>
                        <small class="text-muted">{{ event.time }}</small><br>
                        <strong>{{ event.title }}</strong>
                      </div>
                      <button class="btn btn-sm btn-outline-primary" onclick="addEventToGoogleCalendar('{{ event.title }}', '{{ event.date }}', '{{ event.time }}')" title="Add to Google Calendar">
                        <i class="bi bi-calendar-plus"></i>
                      </button>
                    </div>
                  </div>
                  {% empty %}
                  <div class="text-muted small">No upcoming events</div>
                  {% endfor %}
                </div>
              </div>
            </div>              
          </aside>
            </div>
            
          </main>  
        </div>
      </div>
    </form>
  </div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/browser-notifications.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script src="{% static 'js/RDASHBOARD.js' %}"></script>
<script>
// Pass Django context data to JavaScript
window.dashboardData = {
    accomplishmentData: JSON.parse('{{ accomplishment_chart_data|escapejs }}'),
    visitorsData: JSON.parse('{{ visitors_chart_data|escapejs }}'),
    documentsData: JSON.parse('{{ documents_chart_data|escapejs }}'),
    recentActivity: JSON.parse('{{ recent_activity|escapejs }}')
};
</script>
{% endblock %} 