{% load static %}
<section class="container">
  <h1 class="fw-bold mt-3 mb-3">Request Forms</h1>
  <p class="fst-italic">Request your documents here.</p>

  <!-- New-form trigger -->
  <button class="text-white fw-bold rounded mb-3 custom-btn"
          onclick="openRequestForm(null, true)">
    <i class="bi bi-plus-lg"></i> Fill out new form
  </button>

  <div class="custom-table-wrapper">
    <h4 class="fw-bold text-start">Request Forms History</h4>
    <div class="table-responsive">
      <table class="custom-table table table-bordered table-hover align-middle">
        <thead>
          <tr>
            <th style="width: 20%;">Date</th>
            <th style="width: 40%;">Document Requested</th>
            <th style="width: 20%;" class="text-center">Status</th>
            <th style="width: 20%;" class="text-center">Actions</th>
            
          </tr>
        </thead>
        <tbody>
          {% for req in history_requests %}
            <tr
              data-id="{{ req.id }}"
              data-document-type="{{ req.document_type }}"
              data-purpose="{{ req.purpose }}"
              data-semester="{{ req.semester }}"
            >
            <td>{{  req.created_at|date:"M d, Y â€“ h:i A" }}</td>
              <td class="fw-semibold">{{ req.document_type }}</td>
              <td>
                <span class="
                  fw-semibold
                  {% if req.get_status_display == 'Pending' %}text-warning
                  {% elif req.get_status_display == 'Released' %}text-success
                  {% elif req.get_status_display == 'Draft' %}text-secondary
                  {% else %}text-dark
                  {% endif %}
                ">
                  {{ req.get_status_display }}
                </span>
              </td>
              <td class="text-center">
                {% if req.is_draft %}
                  <!-- Confirm before editing -->
                  <button class="btn btn-sm btn-outline-primary me-1"
                          onclick="confirmEdit('{{ req.id }}')">
                    <i class="bi bi-pencil"></i>
                  </button>
                  <!-- Delete (only for drafts) -->
                  <button class="btn btn-sm btn-outline-danger"
                          onclick="setDeleteId('{{ req.id }}')"
                          data-bs-toggle="modal"
                          data-bs-target="#deleteDraftModal">
                    <i class="bi bi-trash"></i>
                  </button>
                {% else %}
                  <!-- View only -->
                  <button class="btn btn-outline-secondary btn-sm"
                          onclick="viewRequest('{{ req.id }}')">
                    <i class="bi bi-eye"></i>
                  </button>
                {% endif %}
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="4" class="text-center text-muted">No requests yet</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  
</section>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteDraftModal" tabindex="-1" aria-labelledby="deleteDraftModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0">
      <div class="modal-header bg-danger text-white">
        <h5 class="" id="deleteDraftModalLabel">Confirm Delete</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body text-center">
        <p>Are you sure you want to delete this request?</p>
      </div>
      <div class="modal-footer justify-content-center">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" id="confirmDeleteDraftBtn">Delete</button>
      </div>
    </div>
  </div>
</div>
