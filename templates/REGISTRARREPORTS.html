{% extends 'main-registrar.html' %}
{% load static %}

{% block title %}Reports - Registrar{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/RREPORTS.css' %}">
{% endblock %}

{% block main_content %}

  <!-- Main Content -->
  <div class="registrar_generate_report_main-content" id="registrar_generate_report_mainContent">
    {% csrf_token %}
    <form id="registrar_generate_report_form">
      <div class="text-end text-muted mb-2 small">
        <strong>Date:</strong>
        <span id="registrar_generate_report_dateToday"></span>
      </div>
      <h1 class="fw-bold" id="registrar_generate_report_title">Generate Reports</h1>
    
      <!-- Row 1: Date and Status Filters -->
      <div class="row g-3 mb-3" id="registrar_generate_report_filters">
        <div class="col-6 col-md">
          <label class="form-label" for="registrar_generate_report_fromDate">From Date</label>
          <input type="date" class="form-control" id="registrar_generate_report_fromDate">
        </div>
        <div class="col-6 col-md">
          <label class="form-label" for="registrar_generate_report_toDate">To Date</label>
          <input type="date" class="form-control" id="registrar_generate_report_toDate">
        </div>
        <div class="col-6 col-md">
          <label class="form-label" for="registrar_generate_report_formStatus">Form Status</label>
          <select class="form-select" id="registrar_generate_report_formStatus">
            <option value="">All Status</option>
            <option value="approved">Approved Forms</option>
            <option value="pending">Pending Forms</option>
            <option value="declined">Declined Forms</option>
          </select>
        </div>
        <div class="col-6 col-md">
          <label class="form-label" for="registrar_generate_report_periodType">Period</label>
          <select class="form-select" id="registrar_generate_report_periodType">
            <option value="">All Periods</option>
            <option value="week">Week</option>
            <option value="day">Day</option>
          </select>
        </div>
        <div class="col-6 col-md">
          <label class="form-label" for="registrar_reports_formTypeFilter">Form Type</label>
          <select class="form-select" id="registrar_reports_formTypeFilter">
            <option value="">All Form Types</option>
            <option value="clearance">Clearance</option>
            <option value="enrollment">Enrollment</option>
            <option value="graduation">Graduation</option>
            <option value="document_release">Document Release</option>
          </select>
        </div>
      </div>
      
      <!-- Row 2: Advanced Filters and Actions -->
      <div class="d-flex flex-wrap gap-3 mb-3 align-items-end" id="registrar_generate_report_adfilters">
        <div>
          <label class="form-label" for="registrar_reports_roleFilter">Role</label>
          <select class="form-select" id="registrar_reports_roleFilter">
            <option value="">All Roles</option>
            <option value="System">System</option>
            <option value="Signatory">Signatory</option>
            <option value="Registrar">Registrar</option>
            <option value="Admin">Admin</option>
          </select>
        </div>
        <div>
          <label class="form-label" for="registrar_reports_actionFilter">Action</label>
          <select class="form-select" id="registrar_reports_actionFilter">
            <option value="">All Actions</option>
            <option value="approve">Approve</option>
            <option value="disapprove">Disapprove</option>
            <option value="view">View</option>
            <option value="print">Print</option>
            <option value="delete">Delete</option>
          </select>
        </div>
        <div class="flex-grow-1">
          <label class="form-label" for="registrar_reports_searchText">Search</label>
          <input type="text" class="form-control" id="registrar_reports_searchText" placeholder="Search student name, details...">
        </div>
        
          <div class="btn-group">
            <button type="button" class="btn btn-outline-secondary" onclick="clearFilters()">
              <i class="bi bi-arrow-clockwise"></i> Clear
            </button>
            <button type="button" class="btn btn-success" onclick="exportToCSV()">
              <i class="bi bi-download"></i> CSV
            </button>
            <button type="button" class="btn btn-secondary" onclick="registrar_generate_report_toggleGeneratedReportsPanel()">
              <i class="bi bi-list-ul"></i> Reports
            </button>
          </div>
      </div>
    
    
      <div class="registrar_generate_report_table-fixed-container">
        <div class="registrar_generate_report_table-scroll-wrapper">
  <table class="table table-striped table-bordered align-middle mb-0" id="registrar_generate_report_table">
    <thead>
      <tr>
        <th>Student</th>
        <th>Course</th>
        <th>Requested Form</th>
        <th>Action</th>
        <th>Signatory</th>
        <th>IP Address</th>
        <th>Date</th>
        <th>Time</th>
      </tr>
    </thead>
    <tbody id="registrar_generate_report_tableBody">
      <tr>
        <td colspan="8" class="text-center text-muted py-4">
          <div class="spinner-border spinner-border-sm me-2" role="status"></div>
          Loading activities...
        </td>
      </tr>
    </tbody>
  </table>
</div>

      </div>
      
      <!-- Pagination Container -->
      <div id="registrar_reports_pagination" class="mt-3"></div>
    
      <div class="d-flex justify-content-end mt-4">
        <button type="button" class="btn btn-primary" id="registrar_generate_report_generateButton" onclick="registrar_generate_report_generateReport()">Generate Report</button>
      </div>
    
      <div class="generated-report-panel" id="registrar_generate_report_generatedPanel">
        
        <div class="d-flex justify-content-between align-items-center p-3 border-bottom" id="registrar_generate_report_panelContent">
          <h5 class="fw-bold mb-0">Generated Reports</h5>
          <button type="button" class="btn-close" onclick="registrar_generate_report_toggleGeneratedReportsPanel()" id="registrar_generate_report_closePanel"></button>
        </div>
          <!-- Report Filters -->
          <div class="row mb-3">
            <div class="col-md-6">
              <label class="form-label" for="reportsFilterType">Report Type</label>
              <select class="form-select form-select-sm" id="reportsFilterType" onchange="filterReportsList()">
                <option value="">All Types</option>
                <option value="clearance">Clearance</option>
                <option value="enrollment">Enrollment</option>
                <option value="graduation">Graduation</option>
                <option value="document_release">Document Release</option>
                <option value="clearance_pack">Clearance Pack</option>
                <option value="enrollment_pack">Enrollment Pack</option>
                <option value="graduation_pack">Graduation Pack</option>
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label" for="reportsFilterGeneration">Generation</label>
              <select class="form-select form-select-sm" id="reportsFilterGeneration" onchange="filterReportsList()">
                <option value="">All</option>
                <option value="auto">Automated</option>
                <option value="manual">Manual</option>
              </select>
            </div>
          </div>
          
          <!-- On-Demand Pack Generation -->
          <div class="card mb-3 border-info">
            <div class="card-header bg-info text-white py-2">
              <h6 class="mb-0"><i class="bi bi-box-seam"></i> Generate Signatory Pack</h6>
            </div>
            <div class="card-body p-3">
              <div class="row g-2">
                <div class="col-md-6">
                  <label class="form-label small" for="packReportType">Report Type</label>
                  <select class="form-select form-select-sm" id="packReportType">
                    <option value="clearance">Clearance</option>
                    <option value="enrollment">Enrollment</option>
                    <option value="graduation">Graduation</option>
                    <option value="document_release">Document Release</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label small" for="packWeekStart">Week Start (Monday)</label>
                  <input type="date" class="form-control form-control-sm" id="packWeekStart">
                </div>
                <div class="col-12 mt-2">
                  <button type="button" class="btn btn-info btn-sm w-100" onclick="generateSignatoryPack()" id="generatePackBtn">
                    <i class="bi bi-box-seam"></i> Generate Pack
                  </button>
                </div>
              </div>
              <div class="mt-2">
                <small class="text-muted">Generate a ZIP file containing individual signatory reports for the specified week.</small>
              </div>
            </div>
          </div>
          
          <div class="reports-list-container">
            <ul class="list-group" id="registrar_generate_report_listGroup">
              <li class="list-group-item text-center text-muted">
                <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                Loading reports...
              </li>
            </ul>
          </div>
        </div>
      </div>
    </form>
  </div>
  
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/RREPORTS.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
{% endblock %}
