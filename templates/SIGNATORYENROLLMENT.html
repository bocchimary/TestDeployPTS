{% extends 'main-signatory.html' %}
{% load static %}

{% block title %}SIGNATORY ENROLLMENT{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/SENROLLMENT.css' %}">
<style>
/* Hide the modal - keep it functional but invisible */
#pdfPreviewModal {
  display: none !important;
}
</style>
{% endblock %}

{% block main_content %}
  <div class="signatory_enrollment_main-content">
    <form id="signatory_enrollment_form">
      <div class="text-end text-muted mb-2 small"><strong>Date:</strong> <span id="signatory_enrollment_dateToday"></span></div>
      <h1 class="fw-bold">List of Enrollment Forms</h1>

      <!-- Filter + Search Row -->
      <div class="d-flex flex-wrap gap-2 align-items-center mb-3">
          <select class="form-select form-select-sm" style="width: auto;" id="signatory_enrollment_filter_course">
            <option value="" selected disabled>Filter by Course</option>
          </select>
          <select class="form-select form-select-sm" style="width: auto;" id="signatory_enrollment_filter_year">
            <option value="" selected disabled>Filter by Year</option>
          </select>
          <select class="form-select form-select-sm" style="width: auto;" id="signatory_enrollment_filter_section">
            <option value="" selected disabled>Filter by Section</option>
          </select>
          <select class="form-select form-select-sm" style="width: auto;" id="signatory_enrollment_filter_status">
            <option value="" selected disabled>Filter by Status</option>
            <option value="completed">Completed</option>
            <option value="pending">Pending</option>
            <option value="disapproved">Disapproved</option>
          </select>
    
          <!-- Search input right next to filters -->
          <div class="signatory_enrollment_search-bar input-group">
            <input type="text" class="form-control" placeholder="Search" id="signatory_enrollment_search_input">
            <span class="input-group-text"><i class="bi bi-search"></i></span>
          </div>
          
          <!-- Reset Filter Button -->
          <button type="button" class="btn btn-outline-secondary btn-sm" id="signatory_enrollment_reset_filter">
            <i class="bi bi-arrow-clockwise"></i> Reset
          </button>
      </div>

      <!-- Bulk Actions -->
      <div class="d-flex gap-2 align-items-center mb-3" id="signatory_enrollment_bulk_actions" style="display: none;">
        <span class="text-muted small" id="signatory_enrollment_selected_count">0 selected</span>
        <button type="button" class="btn btn-success btn-sm" onclick="bulkApproveEnrollment()">
          <i class="bi bi-check-circle me-1"></i>Bulk Approve
        </button>
        <button type="button" class="btn btn-danger btn-sm" onclick="bulkDisapproveEnrollment()">
          <i class="bi bi-x-circle me-1"></i>Bulk Disapprove
        </button>
        <button type="button" class="btn btn-primary btn-sm" id="signatory_enrollment_bulk_print">
          <i class="bi bi-printer me-1"></i>Bulk Print
        </button>
      </div>

      <div class="signatory_enrollment_table-fixed-container">
        <div class="signatory_enrollment_table-scroll-wrapper">
          <table class="table signatory_enrollment_table text-center align-middle">
              <thead class="table-dark">
                  <tr>
                  <th style="width: 60px;">
                    <input type="checkbox" id="signatory_enrollment_select_all">
                  </th>
                  <th style="width: 250px;">Student's Name</th>
                  <th style="width: 150px;">Course</th>
                  <th style="width: 90px;">Year</th>
                  <th style="width: 100px;">Section</th>
                  <th style="width: 140px;">ID Number</th>
                  <th style="width: 150px;">Date Submitted</th>
                  <th style="width: 200px;">PDF File</th>
                  <th style="width: 160px;">Dean</th>
                  <th style="width: 160px;">Business Manager</th>
                  <th style="width: 160px;">Registrar</th>
                  <th style="width: 150px;">Status</th>
                  <th style="width: 100px;">Actions</th>
                  </tr>
              </thead>
              <tbody id="signatory_enrollment_table_body">
                  <!-- Data will be loaded dynamically -->
              </tbody>
          </table>
          
          <!-- OTP SIDEBAR -->
          <div id="signatory_enrollment_otpSidebar" class="signatory_enrollment_otp-sidebar">
            <div class="signatory_enrollment_otp-header d-flex justify-content-between align-items-start">
              <h4 class="mb-0 fw-bold" id="signatory_enrollment_approve_title">APPROVAL PIN</h4>
              <button type="button" class="btn-close" onclick="closeOtpSidebar()" aria-label="Close"></button>
            </div>
            <div class="signatory_enrollment_otp-body d-flex flex-column align-items-center justify-content-center text-center">
              <p class="text-muted mb-3 w-100 text-start">Input Pincode to Proceed:</p>
              <div class="d-flex justify-content-center gap-2 mb-3">
                <input type="text" class="form-control text-center" maxlength="8" placeholder="Enter PIN" id="signatory_enrollment_otpinput">
              </div>
              <div class="mb-3 w-100">
                <label for="signatory_enrollment_otpComment" class="form-label text-muted">Comment (optional):</label>
                <textarea class="form-control" rows="2" id="signatory_enrollment_otpComment" placeholder="Add a comment..."></textarea>
              </div>
              <div class="text-center">
                <button type="button" class="btn btn-dark signatory_enrollment_approve-btn" id="signatory_enrollment_verifyOtpBtn">APPROVE</button>
              </div>
              <div class="text-danger mt-2" id="signatory_enrollment_otpError" style="display: none;">Incorrect PIN</div>
            </div>
          </div>

          <!-- DISAPPROVE SIDEBAR -->
          <div id="signatory_enrollment_disapproveSidebar" class="signatory_enrollment_otp-sidebar">
            <div class="signatory_enrollment_otp-header d-flex justify-content-between align-items-start">
              <h4 class="mb-0 fw-bold" id="signatory_enrollment_disapprove_title">DISAPPROVE REASON</h4>
              <button type="button" class="btn-close" onclick="closeDisapproveSidebar()" aria-label="Close"></button>
            </div>
          
            <!-- WRAPPER for body steps -->
            <div class="signatory_enrollment_otp-body">
          
              <!-- STEP 1: PIN -->
              <div id="signatory_enrollment_disapprove_pin_step">
                <p class="text-muted mb-3 w-100 text-start">Input Pincode to Proceed:</p>
                <div class="d-flex justify-content-center gap-2 mb-3">
                  <input type="text" class="form-control text-center" maxlength="8" placeholder="Enter PIN" id="signatory_enrollment_disapprove_pin_input">
                </div>
                <div class="text-center mb-2">
                  <button type="button" class="btn btn-dark" id="signatory_enrollment_disapprove_pin_submit_btn">VERIFY</button>
                </div>
                <div class="text-danger mt-2" id="signatory_enrollment_disapprove_pin_error" style="display: none;">Incorrect PIN</div>
              </div>
          
              <!-- STEP 2: Reason (Initially hidden) -->
              <div id="signatory_enrollment_disapprove_reason_step" style="display: none;">
                <p class="text-muted mb-3 w-100 text-start">Please select a reason:</p>
          
                <!-- REASONS -->
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" value="Unpaid fees" id="signatory_enrollment_reason1">
                  <label class="form-check-label" for="signatory_enrollment_reason1">Unpaid fees</label>
                </div>
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" value="Damage to school property" id="signatory_enrollment_reason2">
                  <label class="form-check-label" for="signatory_enrollment_reason2">Damage to school property</label>
                </div>
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" value="Violation of rules" id="signatory_enrollment_reason3">
                  <label class="form-check-label" for="signatory_enrollment_reason3">Violation of rules</label>
                </div>
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" value="Unreturned school property" id="signatory_enrollment_reason4">
                  <label class="form-check-label" for="signatory_enrollment_reason4">Unreturned school property</label>
                </div>
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" value="Incomplete Requirements/Documents" id="signatory_enrollment_reason5">
                  <label class="form-check-label" for="signatory_enrollment_reason5">Incomplete Requirements/Documents</label>
                </div>
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" value="Incomplete course requirements" id="signatory_enrollment_reason6">
                  <label class="form-check-label" for="signatory_enrollment_reason6">Incomplete course requirements</label>
                </div>
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" value="Unsettled promissory note" id="signatory_enrollment_reason7">
                  <label class="form-check-label" for="signatory_enrollment_reason7">Unsettled promissory note</label>
                </div>
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" value="Incomplete academic units" id="signatory_enrollment_reason8">
                  <label class="form-check-label" for="signatory_enrollment_reason8">Incomplete academic units</label>
                </div>
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" value="Other" id="signatory_enrollment_reasonOther" onchange="toggleOtherReasonInput()">
                  <label class="form-check-label" for="signatory_enrollment_reasonOther">Other</label>
                </div>
          
                <div class="mb-2" id="signatory_enrollment_otherReasonContainer" style="display: none;">
                  <input type="text" id="signatory_enrollment_otherReasonInput" class="form-control" placeholder="Enter other reason">
                </div>
          
                <!-- Comment -->
                <div class="mb-3 w-100">
                  <label for="signatory_enrollment_disapproveComment" class="form-label text-muted">Comment (optional):</label>
                  <textarea class="form-control" rows="2" id="signatory_enrollment_disapproveComment" placeholder="Add a comment..."></textarea>
                </div>
          
                <!-- Appointment -->
                <div id="signatory_enrollment_appointmentContainer" class="mt-4">
                  <label for="signatory_enrollment_appointmentDate" class="form-label text-muted">Set Appointment Date:</label>
                  <input type="date" id="signatory_enrollment_appointmentDate" class="form-control mb-2">
                  <button type="button" class="btn btn-primary btn-sm w-100" id="signatory_enrollment_submit_Appointment_Disapproval_Btn">Submit Disapproval and Appointment</button>
          
                  <div class="text-danger mt-2" id="signatory_enrollment_disapproveError" style="display: none;">Please select a reason</div>
                  <div class="text-danger mt-1" id="signatory_enrollment_appointmentError" style="display: none;">Please select an appointment date</div>
                </div>
              </div>
            </div>
          </div>
          
        </div>
      </div>


    </form>  
  </div>

  <!-- PDF PREVIEW MODAL -->
  <div class="modal fade" id="pdfPreviewModal" tabindex="-1" aria-labelledby="pdfPreviewModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="pdfPreviewModalLabel">
            <i class="bi bi-file-pdf me-2"></i>Enrollment Form Preview
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- Loading indicator -->
          <div id="pdfPreviewLoading" class="d-flex justify-content-center align-items-center py-5">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <span class="ms-2">Loading form preview...</span>
          </div>
          
          <!-- PDF content container -->
          <div id="pdfPreviewContent" class="pdf-preview-content" style="display: none;">
            <!-- Content will be loaded here -->
          </div>
          
          <!-- CSS to isolate PDF content from affecting the main page -->
          <style>
            .pdf-modal-content body {
              margin: 0;
              padding: 20px;
              font-family: Arial, sans-serif;
              line-height: 1.6;
            }
            
            .pdf-modal-content table {
              width: 100%;
              border-collapse: collapse;
              margin-bottom: 20px;
            }
            
            .pdf-modal-content th,
            .pdf-modal-content td {
              border: 1px solid #000;
              padding: 8px;
              text-align: left;
            }
            
            .pdf-modal-content th {
              background-color: #f5f5f5;
              font-weight: bold;
            }
            
            .pdf-modal-content h1,
            .pdf-modal-content h2,
            .pdf-modal-content h3 {
              margin-top: 0;
              margin-bottom: 10px;
            }
          </style>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            <i class="bi bi-x-circle me-1"></i>Close
          </button>
          <button type="button" class="btn btn-primary" id="printPreviewBtn">
            <i class="bi bi-printer me-1"></i>Print
          </button>
        </div>
      </div>
    </div>
  </div>

{% endblock %}

{% block extra_js %}
<script src="{% static 'js/SENROLLMENT.js' %}"></script>
{% endblock %}
