<!DOCTYPE html>
{% load static %}
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reset Password - PTS College and Advanced Studies</title>
    <link rel="icon" type="image/png" href="{% static 'images/logo.png' %}">
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="{% static 'css/login.style.css' %}" />

    <style>
      .reset-password-container {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        padding: 40px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        max-width: 500px;
        margin: auto;
      }
      
      .reset-title {
        color: #2E5978;
        font-weight: 600;
        margin-bottom: 20px;
      }
      
      .back-to-login {
        color: #2E5978;
        text-decoration: none;
        font-size: 14px;
      }
      
      .back-to-login:hover {
        color: #1a3a4f;
        text-decoration: underline;
      }
      
      .submit-btn {
        background-color: #2E5978;
        border: none;
        border-radius: 25px;
        padding: 12px 30px;
        font-weight: 500;
      }
      
      .submit-btn:hover {
        background-color: #1a3a4f;
      }
      
      .password-requirements {
        font-size: 12px;
        color: #6c757d;
        margin-top: 5px;
      }
      
      .user-info {
        background-color: #e7f3ff;
        border: 1px solid #b3d9ff;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 20px;
      }
    </style>
  </head>

  <body>
    <!-- Main Section -->
    <main class="container-fluid min-vh-100 bg-dark">

      <div class="row g-0 d-flex justify-content-center align-items-center min-vh-100">
        <!-- Left Column - Title Section -->
        <div class="col-12 col-lg-6 d-flex align-items-center justify-content-center text-center p-4">
          <div class="px-3 text-center page-title fade-in-left">
            <h1 class="fs-1">Office of the Registrar</h1>
            <h2 class="h5">PTS College and Advanced Studies</h2>
          </div>
        </div>

        <!-- Right Column - Reset Password Form -->
        <div class="col-12 col-lg-6 d-flex justify-content-center align-items-center p-4"
             style="min-height: 100vh;">
          <div class="reset-password-container">
            <!-- Back to Login Link -->
            <div class="text-start mb-3">
              <a href="{% url 'login' %}" class="back-to-login">
                <i class="bi bi-arrow-left me-2"></i>Back to Login
              </a>
            </div>
            
            <h2 class="text-center reset-title">üîê Reset Password</h2>
            
            <!-- User Info -->
            <div class="user-info text-center">
              <h6 class="mb-1">üë§ {{ user_name }}</h6>
              <small class="text-muted">{{ email }}</small>
            </div>
            
            <p class="text-center text-muted mb-4">
              Enter your new password below. Make sure it's strong and secure.
            </p>
            
            <!-- Error/Success Messages -->
            {% if messages %}
              {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                  {{ message }}
                  <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
              {% endfor %}
            {% endif %}
            
            <form method="POST" action="{% url 'reset_password_submit' %}" id="resetPasswordForm">
              {% csrf_token %}
              <input type="hidden" name="token" value="{{ token }}">
              
              <div class="form-group mb-4">
                <label for="new_password" class="form-label">New Password</label>
                <div class="position-relative">
                  <input
                    type="password"
                    name="new_password"
                    id="new_password"
                    class="form-control"
                    required
                    minlength="8"
                    placeholder="Enter new password"
                    aria-label="New password"
                  />
                  <button type="button" class="btn btn-outline-secondary position-absolute top-50 end-0 translate-middle-y me-2" 
                          onclick="togglePassword('new_password')" style="border: none; background: none;">
                    <i class="bi bi-eye" id="new_password_icon"></i>
                  </button>
                </div>
                <div class="password-requirements">
                  Password must be at least 8 characters long
                </div>
              </div>
              
              <div class="form-group mb-4">
                <label for="confirm_password" class="form-label">Confirm New Password</label>
                <div class="position-relative">
                  <input
                    type="password"
                    name="confirm_password"
                    id="confirm_password"
                    class="form-control"
                    required
                    minlength="8"
                    placeholder="Confirm new password"
                    aria-label="Confirm new password"
                  />
                  <button type="button" class="btn btn-outline-secondary position-absolute top-50 end-0 translate-middle-y me-2" 
                          onclick="togglePassword('confirm_password')" style="border: none; background: none;">
                    <i class="bi bi-eye" id="confirm_password_icon"></i>
                  </button>
                </div>
                <div id="password-match-message" class="mt-2"></div>
              </div>
              
              <div class="d-flex justify-content-center mb-4">
                <button type="submit" class="btn submit-btn w-75 text-white" id="submitBtn">
                  üîÑ Reset Password
                </button>
              </div>
              
              <div class="text-center">
                <hr class="border border-dark border-1 opacity-25 my-3" />
                <p class="text-muted mb-0">
                  Remember your password? 
                  <a href="{% url 'login' %}" class="back-to-login">Sign in here</a>
                </p>
              </div>
            </form>
          </div>
        </div>
      </div>
    </main>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Password visibility toggle
      function togglePassword(inputId) {
        const input = document.getElementById(inputId);
        const icon = document.getElementById(inputId + '_icon');
        
        if (input.type === 'password') {
          input.type = 'text';
          icon.classList.remove('bi-eye');
          icon.classList.add('bi-eye-slash');
        } else {
          input.type = 'password';
          icon.classList.remove('bi-eye-slash');
          icon.classList.add('bi-eye');
        }
      }

      // Password matching validation
      const newPassword = document.getElementById('new_password');
      const confirmPassword = document.getElementById('confirm_password');
      const matchMessage = document.getElementById('password-match-message');
      const submitBtn = document.getElementById('submitBtn');

      function checkPasswordMatch() {
        if (confirmPassword.value === '') {
          matchMessage.innerHTML = '';
          matchMessage.className = '';
          return;
        }

        if (newPassword.value === confirmPassword.value) {
          matchMessage.innerHTML = '<small class="text-success"><i class="bi bi-check-circle me-1"></i>Passwords match</small>';
          matchMessage.className = '';
          submitBtn.disabled = false;
        } else {
          matchMessage.innerHTML = '<small class="text-danger"><i class="bi bi-x-circle me-1"></i>Passwords do not match</small>';
          matchMessage.className = '';
          submitBtn.disabled = true;
        }
      }

      newPassword.addEventListener('input', checkPasswordMatch);
      confirmPassword.addEventListener('input', checkPasswordMatch);

      // Auto-focus on new password input
      document.getElementById('new_password').focus();

      // Form submission validation
      document.getElementById('resetPasswordForm').addEventListener('submit', function(e) {
        if (newPassword.value !== confirmPassword.value) {
          e.preventDefault();
          alert('Passwords do not match. Please check and try again.');
          return false;
        }
        
        if (newPassword.value.length < 8) {
          e.preventDefault();
          alert('Password must be at least 8 characters long.');
          return false;
        }
      });
    </script>
  </body>
</html>