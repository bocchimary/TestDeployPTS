<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Credential Request Report</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,600;0,800;1,800&display=swap"
      rel="stylesheet"
    />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">

    <style>
        @page {
            margin: 20mm;
            size: A4;
        }
        
        body {
          font-family: 'Open Sans', Arial, sans-serif;
          font-size: 11px;
          line-height: 1.4;
          color: #333;
          background: white;
        }

        .document-header {
          text-align: center;
          border-bottom: 3px solid #003399;
          padding-bottom: 20px;
          margin-bottom: 30px;
        }

        .institution-title {
          font-family: "Open Sans", sans-serif;
          font-weight: 800;
          font-size: 24px;
          color: #003399;
          margin-bottom: 5px;
        }
        
        .institution-address {
          font-weight: 600;
          font-size: 12px;
          color: #666;
          margin-bottom: 15px;
        }
        
        .document-title {
          font-size: 16px;
          font-weight: 700;
          color: #003399;
          text-transform: uppercase;
          letter-spacing: 1px;
        }

        .form-body {
          margin: 20px 0;
        }
        
        .form-section {
          margin-bottom: 25px;
          border: 1px solid #ddd;
          border-radius: 5px;
          padding: 15px;
        }
        
        .section-title {
          font-size: 14px;
          font-weight: 700;
          color: #003399;
          margin: 0 0 15px 0;
          padding-bottom: 5px;
          border-bottom: 2px solid #003399;
        }
        
        .form-row {
          display: flex;
          margin-bottom: 10px;
          gap: 20px;
        }
        
        .form-field {
          flex: 1;
          display: flex;
          flex-direction: column;
        }
        
        .form-field.full-width {
          flex: none;
          width: 100%;
        }
        
        .field-label {
          font-weight: 600;
          font-size: 10px;
          color: #666;
          margin-bottom: 2px;
          text-transform: uppercase;
        }
        
        .field-value {
          font-size: 12px;
          color: #333;
          padding: 5px;
          border-bottom: 1px solid #ddd;
          min-height: 20px;
        }

        .status-badge {
          display: inline-block;
          padding: 2px 6px;
          border-radius: 3px;
          font-size: 9px;
          font-weight: 600;
          text-transform: uppercase;
        }
        
        .status-pending { background-color: #fff3cd; color: #856404; }
        .status-processing { background-color: #d1ecf1; color: #0c5460; }
        .status-ready { background-color: #d4edda; color: #155724; }
        .status-released { background-color: #e2e3e5; color: #383d41; }

        .approval-status {
          font-size: 9px;
          font-weight: 600;
        }
        
        .approved { color: #28a745; }
        .disapproved { color: #dc3545; }
        .pending { color: #ffc107; }

        .document-footer {
          border-top: 2px solid #003399;
          padding-top: 15px;
          margin-top: 30px;
        }
        
        .signature-section {
          display: flex;
          justify-content: space-between;
          margin-top: 40px;
          gap: 20px;
        }
        
        .signature-block {
          text-align: center;
          flex: 1;
        }
        
        .signature-line {
          border-top: 1px solid #333;
          margin-top: 40px;
          padding-top: 5px;
          font-size: 10px;
          font-weight: 600;
        }
        
        .signature-date {
          font-size: 9px;
          color: #666;
          margin-top: 5px;
        }

        .print-metadata {
          display: flex;
          justify-content: space-between;
          font-size: 9px;
          color: #666;
          margin-bottom: 10px;
        }

        @media print {
          body { 
            margin: 0; 
            font-size: 10px;
          }
          .form-section { 
            page-break-inside: avoid; 
          }
          .signature-section {
            page-break-inside: avoid;
          }
          .document-footer {
            page-break-inside: avoid;
          }
        }
    </style>
  </head>

  <body>
    {% if credential_requests %}
        {% for request in credential_requests %}
            {% if not forloop.first %}<div style="page-break-before: always;"></div>{% endif %}
            
            <div class="document-header">
                <div class="institution-title">PERPETUAL THEOLOGICAL SEMINARY</div>
                <div class="institution-address">Poblacion, Mandaluyong City</div>
                <div class="document-title">Credential Request Form</div>
            </div>

            <div class="form-body">
                <div class="form-section">
                    <h3 class="section-title">Student Information</h3>
                    <div class="form-row">
                        <div class="form-field">
                            <label class="field-label">Name:</label>
                            <span class="field-value">{{ request.requester.full_name|default:"N/A" }}</span>
                        </div>
                        <div class="form-field">
                            <label class="field-label">Student Number:</label>
                            <span class="field-value">{{ request.requester.profile.student_number|default:"N/A" }}</span>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label class="field-label">Program/Course:</label>
                            <span class="field-value">{{ request.requester.profile.program|default:"N/A" }}</span>
                        </div>
                        <div class="form-field">
                            <label class="field-label">Year Level:</label>
                            <span class="field-value">{{ request.requester.profile.year_level|default:"N/A" }}</span>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3 class="section-title">Request Details</h3>
                    <div class="form-row">
                        <div class="form-field">
                            <label class="field-label">Document Type:</label>
                            <span class="field-value">{{ request.document_type|default:"N/A" }}</span>
                        </div>
                        <div class="form-field">
                            <label class="field-label">Request Date:</label>
                            <span class="field-value">{{ request.created_at|date:"F d, Y" }}</span>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field full-width">
                            <label class="field-label">Purpose:</label>
                            <span class="field-value">{{ request.purpose|default:"N/A" }}</span>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3 class="section-title">Processing Status</h3>
                    <div class="form-row">
                        <div class="form-field">
                            <label class="field-label">Overall Status:</label>
                            <span class="status-badge status-{{ request.status|lower }}">{{ request.status|title|default:"Pending" }}</span>
                        </div>
                        <div class="form-field">
                            <label class="field-label">Business Manager Status:</label>
                            {% if request.business_manager_status == 'approved' %}
                                <span class="approval-status approved">
                                    <i class="bi bi-check-circle"></i> APPROVED
                                </span>
                            {% elif request.business_manager_status == 'disapproved' %}
                                <span class="approval-status disapproved">
                                    <i class="bi bi-x-circle"></i> DISAPPROVED
                                </span>
                            {% else %}
                                <span class="approval-status pending">
                                    <i class="bi bi-clock"></i> PENDING
                                </span>
                            {% endif %}
                        </div>
                    </div>
                    {% if request.business_manager_timestamp %}
                    <div class="form-row">
                        <div class="form-field">
                            <label class="field-label">Date Processed:</label>
                            <span class="field-value">{{ request.business_manager_timestamp|date:"F d, Y - g:i A" }}</span>
                        </div>
                    </div>
                    {% endif %}
                    {% if request.business_manager_comment %}
                    <div class="form-row">
                        <div class="form-field full-width">
                            <label class="field-label">Comments:</label>
                            <span class="field-value">{{ request.business_manager_comment }}</span>
                        </div>
                    </div>
                    {% endif %}
                </div>

                <div class="signature-section">
                    <div class="signature-block">
                        <div class="signature-line">Student Signature</div>
                        <div class="signature-date">Date: ___________</div>
                    </div>
                    <div class="signature-block">
                        <div class="signature-line">Business Manager</div>
                        <div class="signature-date">Date: ___________</div>
                    </div>
                    <div class="signature-block">
                        <div class="signature-line">Registrar</div>
                        <div class="signature-date">Date: ___________</div>
                    </div>
                </div>
            </div>

            <div class="document-footer">
                <div class="print-metadata">
                    <div><strong>Form Generated:</strong> {{ print_date }}</div>
                    <div><strong>Prepared By:</strong> {{ printed_by }}</div>
                </div>
            </div>
        {% endfor %}
    {% endif %}
  </body>
</html>