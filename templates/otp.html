<!DOCTYPE html>
{% load static %}
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Verification</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="{% static 'css/style.css' %}" />
    
  <style>
    body {
      margin: 0;
      overflow-x: hidden;
      background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.5)), url('{% static "images/ptsbg.png" %}');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: fixed;
    }

    .otp {
        width: 400px;
        height: auto;
        min-height: 300px;
        background-color:rgba(252, 252, 252, 0.9);
        padding: 2rem;
        border-radius: 1rem;
    }
    .submit {
        background-color:#2E5978 !important;
    }
    
    .mtop {
        margin-top:-50px;
    }
    .fsize-1 {
        font-size: 15px;
    }
</style> 
  </head>

  <body>

  <!-- LOGIN FORM -->
  <div class="container min-vh-100 d-flex justify-content-center align-items-center mtop">
    <div class="otp p-4 rounded shadow-sm bg-white">
      <h2 class="text-center mb-2">üîê Email Verification</h2>
      <p class="text-center text-muted mb-2" style="font-size: 12px;">PTS College and Advanced Studies</p>
      <hr class="border border-dark border-1 opacity-75" />

      <form method="POST" action="{% url 'verify_otp_submit' %}">
        {% csrf_token %}

        <!-- OTP INPUT 4 DIGITS -->
        <div class="row d-flex justify-content-center mt-3 mb-3">
          <div class="col-8">
            <input
              type="text"
              name="otp"
              id="code"
              class="form-control text-center"
              pattern="\d{4}"
              maxlength="4"
              inputmode="numeric"
              placeholder="Type OTP code"
              required
            />
          </div>
        </div>

        <!-- OTP RESEND CODE -->
        <div class="text-center mb-2">
          <button type="button" class="btn btn-link text-decoration-underline text-black" id="resend-btn">
            Resend OTP code
          </button>
        </div>

        <p class="fsize-1 text-center text-muted mb-3">
          Please check your email <strong>({{ email }})</strong> for the One-Time Password (OTP) that has been sent by the system.
        </p>

        <!-- SUBMIT BUTTON -->
        <div class="text-center">
          <button class="btn w-50 text-white submit" type="submit">
            Submit
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Handle resend OTP
    document.getElementById('resend-btn').addEventListener('click', function() {
      const btn = this;
      btn.disabled = true;
      btn.textContent = 'Sending...';

      fetch("{% url 'resend_otp' %}", {
        method: 'POST',
        headers: {
          'X-CSRFToken': '{{ csrf_token }}',
          'Content-Type': 'application/json'
        }
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          btn.textContent = 'OTP Sent!';
          setTimeout(() => {
            btn.disabled = false;
            btn.textContent = 'Resend OTP code';
          }, 3000);
        } else {
          btn.textContent = 'Error sending';
          btn.disabled = false;
          alert('Error: ' + (data.error || 'Failed to send OTP'));
        }
      })
      .catch(error => {
        console.error('Error:', error);
        btn.textContent = 'Error sending';
        btn.disabled = false;
        alert('Network error occurred');
      });
    });

    // Auto-focus on OTP input
    document.getElementById('code').focus();
  </script>
</body>

</html>
